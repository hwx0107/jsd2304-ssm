## 介绍

### 课程介绍

* 数据库MariaDB
* 框架 SSM

### 自我介绍

* 王伟超

* wangweichao@tedu.cn





## 数据库分类

* 关系型数据库

  数据以行和列（二维表）方式存储；

  Oracle、MySQL（**磁盘**）、MariaDB（**磁盘**）、SQL Server

* 非关系型数据库

  数据以键值对的方式存储；

  MongoDB、Redis（**内存**）

## SQL语言

* DDL：操作数据库对象（库、表、表字段）
* DML：操作数据（数据的增删改）
* DQL：查询数据

## SQL语句

* 库操作

  * 创建库：CREATE DATABASE 库名 CHARSET=UTF8;
  * 查看所有库：SHOW DATABASES;
  * 查看创建库语句[字符集]：SHOW CREATE DATABASE 库名;
  * 切换库：USE 库名;
  * 删除库：DROP DATABASE 库名;

* 表操作

  * 创建表：CREATE TABLE 表名(字段名 数据库类型,字段名 数据类型) CHARSET=UTF8;
  * 查看所有表：SHOW TABLES;
  * 查看表结构：DESC 表名;
  * 查看创建表的语句：SHOW CREATE TABLE 表名;
  * 删除表：DROP TABLE 表名;
  * 修改表名：RNAME 原表名 TO 新表名;

* 表字段操作

  * 添加表字段

    * 末尾添加：ALTER TABLE 表名 ADD 字段名 数据类型;
    * 添加到第一个字段：ALTER TABLE 表名 ADD 字段名 数据类型 FIRST;
    * 指定位置添加字段：ALTER TABLE 表名 ADD 字段名 数据类型 AFTER 字段名;

  * 删除表字段

    ALTER TABLE 表名 DROP 字段名;

  * 修改表字段类型

    ALTER TABLE 表名 MODIFY 字段名 新数据类型;

  * 替换表字段

    ALTER TABLE 表名 CHANGE 原字段名 新字段名 数据类型;

* 表数据操作

  * 增INSERT

    INSERT INTO 表名(字段名,...) VALUES (第一条表记录),(第二条表记录);

  * 删DELETE

    DELETE FROM 表名 WHERE 过滤条件;

  * 改UPDATE

    UPDATE 表名 SET 字段名=值,字段名=值 WHERE 过滤条件;

  * 查SELECT

    SELECT * FROM 表名;

## 数据类型

### 1 数值类型

* 整型

  * TINYINT：微小整型，占1个字节 `-128 ~ 127`
  * SMALLINT：小整型，占2个字节 
  * MEDIUMINT：中整型，占3个字节
  * INT：大整型，占4个字节
  * BIGINT：极大整型，占8个字节

* 浮点型

  * DOUBLE

    `字段名 DOUBLE(M,N) M代表总位数，N代表小数位位数`

### 2 字符类型

* 定长

  CHAR(m)    `m指的是字符的宽度`

  浪费磁盘存储空间，但是数据存取效率高。

* 变长

  VARCHAR(m)

  节约磁盘存储空间，但是数据存取效率低。

* 文本类型

  TEXT

  LONGTEXT

### 3 日期时间类型

* 日期DATE：`'2023-06-07'`

* 时间TIME：`'09:12:15'`

* 日期时间DATETIME `2023-06-07 09:12:15`

* 日期时间TIMESTAMP `2023-06-07 09:12:15`

  

<font color=red>**MariaDB可以存储图片、文件等类型数据，但是一般不会在数据库中存储，一般情况下会把图片等存储到服务器中，而在数据库中只存储图片文件所在的路径(字符串)**</font>



## 约束

* 主键约束 `PRIMARY KEY AUTO_INCREMENT`

  字段的值不允许重复，而且不允许为空值NULL

  `一般把表中的记录编号的字段id设置为主键`

* 非空约束 `NOT NULL`

  字段的值不允许为空值NULL

* 唯一约束 `UNIQUE`

  字段的值不允许重复，但是可以为空值NULL

* 检查约束 `CHECK`

  可以增加条件的限定

* 外键约束 `FOREIGN KEY`

  `CONSTRAINT 外键名称 FOREIGN KEY 从表(外键字段) REFERENCES 主表(主键字段) ON DELETE 级联动作 ON UPDATE 级联动作`
  
  * RESTRICT[默认]
    * 主表删除数据时，如果从表中有相关联的数据则不允许主表删除；
    * 主表更新主键字段时，如果从表中有相关联的数据则不允许主表更新；
  * CASCADE级联更新级联删除
    * 主表删除数据时，从表中相关联的数据也会一并删除；
    * 主表更新主键字段时，从表中相关联的数据也会一并更新；
  * SET NULL设置为空值
    * 主表删除数据时，从表中相关联的数据的外键字段的值会设置为 NULL
    * 主表更新主键字段时，从表中相关联的数据的外键字段的值会设置为 NULL

### MariaDB字符集

* 常见的字符集：`latin1、utf8、gbk`

* 创建库时：

  `CREATE DATABASE 库名;`  

  未指定字符集，如果是之前的MariaDB版本，默认是 `latin1`  ，对中文支持不友好。

  如果是MariaDB后期的版本，默认是 `utf8` ，对中文支持没有问题。

* 养成好习惯

  * 创建库，指定字符集：`CREATE DATABASE 库名 CHARSET=UTF8;`
  * 创建表，指定字符集：`CREATE TABLE 表名(......)CHARSET=UTF8;`

## 子查询

### 1 定义

子查询也叫嵌套查询，嵌套在一个SQL语句中的DQL语句，该DQL语句被称为子查询。

### 2 分类

* 单行单列子查询：条件筛选时使用 `> >= < <= !=`
* 多行单列子查询：条件筛选时使用 `IN  NOT IN`
* 多行多列子查询：查询的结果集创建为表时使用 `CREATE TABLE 表名 AS 多行多列子查询语句`

## 关联查询

### 1 关联关系

* 一对一关系

  A表中的一条记录对应B表中的唯一一条记录，B表中的一条记录对应A表中的唯一一条记录；

  比如：作者表和作者妻子表；

* 一对多关系

  A表中的一条记录对应B表中多条表记录，B表中的一条记录只能对应A表中的一条表记录；

  比如：用户表和订单表；班级表和学生表；城市表和学生表；

* 多对多关系

  A表中的一条记录对应B表中的多条表记录，B表中的一条记录也对应A表中的多条表记录；

  比如：学生表和科目表；

  多对多关系使用第三张表 `关联关系表` 进行管理。

### 2 什么是笛卡尔积

将两个或者多个表的每一行记录都组合起来，生成结果集中所有可能的组合，通常是由于联合查询中未指定连接条件；

笛卡尔积的结果集通常很庞大，会占用大量的内存和CPU资源，在实际开发中，应避免！



## 连接查询

* 内连接 JOIN

  只显示满足条件的所有数据。

  `SELECT ... FROM 表A JOIN 表B ON 条件`

* 外连接

  * 左外连接 LEFT JOIN

    以左表为驱动表查询，左表中所有数据都会显示，右表中有不满足连接的数据，则以NULL值填充

  * 右外连接 RIGHT JOIN

    以右表为驱动表查询，右表中所有数据都会显示，左表中有不满足连接的数据，则以NULL值填充

* 自连接



















* 用户表

  | 用户编号 | 用户名 | 密码   |
  | -------- | ------ | ------ |
  | 1        | 张三   | 123456 |
  | 2        | 李四   | 123456 |

* 订单表

  | 订单编号 | 订单金额 | 订单状态 | 用户编号 |
  | -------- | -------- | -------- | -------- |
  | 111111   | 5000.00  | 待付款   | 1        |
  | 222222   | 6000.00  | 待发货   | 1        |
  



```mysql
1.确认数据来源(表):FROM 
2.确定连接条件: 相关联字段
3.确定过滤条件: AND ...
```

















